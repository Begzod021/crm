{% extends 'base.html' %}
{% load static %}
{% block static %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
    <script>

      $(document).ready(function () {
          var calendar = $('#calendar').fullCalendar({
              header: {
                  left: 'prev,next today',
                  center: 'title',
                  right: 'month,agendaWeek,agendaDay'
              },
              events: '/all_tasks/{{ user.username }}',
              selectable: true,
              selectHelper: true,
              editable: true,
              eventLimit: true,
              select: function (start, end, allDay) {
                  var title = prompt("Enter Task Title");
                  if (title) {
                      var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
                      var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
                      $.ajax({
                          type: "GET",
                          url: '/all_tasks/{{ user.username }}',
                          data: {'title': title, 'start': start, 'end': end},
                          dataType: "json",
                          success: function (data) {
                              calendar.fullCalendar('refetchEvents');
                              alert("Added Successfully");
                          },
                          error: function (data) {
                              alert('There is a problem!!!');
                          }
                      });
                      $.ajax({
                        type: "GET",
                        url: '/add_task',
                        data: {'title': title, 'start': start, 'end': end},
                        dataType: "json",
                        success: function (data) {
                            calendar.fullCalendar('refetchEvents');
                            alert("Added Successfully");
                        },
                        error: function (data) {
                            alert('There is a problem!!!');
                        }
                    });
                  }
              },
              {% if position1.position == "director" %}
              eventResize: function (task) {
                  var start = $.fullCalendar.formatDate(task.start, "Y-MM-DD HH:mm:ss");
                  var end = $.fullCalendar.formatDate(task.end, "Y-MM-DD HH:mm:ss");
                  var title = task.title;
                  var id = task.id;
                  $.ajax({
                      type: "GET",
                      url: '/update',
                      data: {'title': title, 'start': start, 'end': end, 'id': id},
                      dataType: "json",
                      success: function (data) {
                          calendar.fullCalendar('refetchEvents');
                          alert('Event Update');
                      },
                      error: function (data) {
                          alert('There is a problem!!!');
                      }
                  });
              },

              eventDrop: function (task) {
                  var start = $.fullCalendar.formatDate(task.start, "Y-MM-DD HH:mm:ss");
                  var end = $.fullCalendar.formatDate(task.end, "Y-MM-DD HH:mm:ss");
                  var title = task.title;
                  var id = task.id;
                  $.ajax({
                      type: "GET",
                      url: '/update',
                      data: {'title': title, 'start': start, 'end': end, 'id': id},
                      dataType: "json",
                      success: function (data) {
                          calendar.fullCalendar('refetchEvents');
                          alert('Event Update');
                      },
                      error: function (data) {
                          alert('There is a problem!!!');
                      }
                  });
              },
              {% endif %}
              {% if position1.position == "director" %}
              eventClick: function (task) {
                  if (confirm("Are you sure you want to remove it?")) {
                      var id = task.id;
                      $.ajax({
                          type: "GET",
                          url: '/remove',
                          data: {'id': id},
                          dataType: "json",
                          success: function (data) {
                              calendar.fullCalendar('refetchEvents');
                              alert('Event Removed');
                          },
                          error: function (data) {
                              alert('There is a problem!!!');
                          }
                      });
                  }
              },
              {% endif %}

          });
      });

  </script>
{% endblock static %}
{% block content %}
                <!-- ### $App Screen Content ### -->
        <main class="main-content bgc-grey-100">
          <div id="mainContent">
            <div class="container-fluid">
              <div class="row">
                <div class="col-md-4">
                  <div class="bdrs-3 ov-h bgc-white bd">
                    <div class="bgc-deep-purple-500 ta-c p-30">
                      <h1 class="fw-300 mB-5 lh-1 c-white">01<span class="fsz-def">st</span></h1>
                      <h3 class="c-white">Monday</h3>
                    </div>
                    <div class="pos-r">
                      <button type="button" class="mT-nv-50 pos-a r-10 t-2 btn cur-p bdrs-50p p-0 w-3r h-3r btn-warning">
                        <i class="ti-plus"></i>
                      </button>
                      <ul class="m-0 p-0 mT-20">
                        <li class="bdB peers ai-c jc-sb fxw-nw">
                          <a class="td-n p-20 peers fxw-nw mR-20 peer-greed c-grey-900" href="javascript:void(0);" data-toggle="modal" data-target="#calendar-edit">
                            <div class="peer mR-15">
                              <i class="fa fa-fw fa-clock-o c-red-500"></i>
                            </div>
                            <div class="peer">
                              <span class="fw-600">All Day Event</span>
                              <div class="c-grey-600">
                                <span class="c-grey-700">Nov 01 - </span>
                                <i>Website Development</i>
                              </div>
                            </div>
                          </a>
                          <div class="peers mR-15">
                            <div class="peer">
                              <a href="http://symfonator.herokuapp.com/admin/calendar" class="td-n c-deep-purple-500 cH-blue-500 fsz-md p-5">
                                <i class="ti-pencil"></i>
                              </a>
                            </div>
                            <div class="peer">
                              <a href="http://symfonator.herokuapp.com/admin/calendar" class="td-n c-red-500 cH-blue-500 fsz-md p-5">
                                <i class="ti-trash"></i>
                              </a>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="container">
                    <div id="calendar"></div>
                  </div>
                </div>
              </div>
              <div class="modal fade" id="calendar-edit">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="bd p-15">
                      <h5 class="m-0">Add Event</h5>
                    </div>
                    <div class="modal-body">
                      <form  method="POST">{% csrf_token %}
                        <div class="form-group">
                          <label class="fw-500">Event title</label>
                          {{ form.title }}
                        </div>
                        <div class="row">
                          {% if request.user.is_superuser %}
                            <p>Choose Employe:</p><br>
                            {{ form.employe }}
                          {% else %}
                          <p>Choose Employe:</p><br>
                          <select name="employe" id="id_employe">
                            <option value="" selected="">---------</option>
                            {% for el1 in task_users %}
                            <option name="el1.user.id" value="{{ el1.user.id }}">{{ el1.user }}</option>
                            {% endfor %}
                          </select>
                          {% endif %}
                          {% if task %}
                          <label for="job">Section</label>
                          <select name="section" required id="id_section">
                            <option name="task.section.id" value="{{ task.section.id }}">{{ task.section }}</option>
                          </select>
                          {% else %}
                          <label for="job">Section</label>
                            {{ form.section }}
                          {% endif %}
                        </div>
                        <div class="row">
                          <div class="col-md-6"><br>
                            <label class="fw-500">Start</label>
                            <div class="timepicker-input input-icon form-group">
                              <div class="input-group">
                                <div class="input-group-addon bgc-white bd bdwR-0">
                                  <i class="ti-calendar"></i>
                                </div>
                                {{ form.start }}
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6"><br>
                            <label class="fw-500">End</label>
                            <div class="timepicker-input input-icon form-group">
                              <div class="input-group">
                                <div class="input-group-addon bgc-white bd bdwR-0">
                                  <i class="ti-calendar"></i>
                                </div>
                                {{ form.end }}
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="fw-500">Event title</label>
                          {{ form.description }}
                        </div>
                        <div class="text-right">
                          <button class="btn btn-primary cur-p">Done</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
{% endblock content %}